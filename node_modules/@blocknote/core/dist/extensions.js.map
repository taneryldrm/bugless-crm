{"version":3,"file":"extensions.js","sources":["../src/extensions/SuggestionMenu/getDefaultEmojiPickerItems.ts"],"sourcesContent":["import type { Emoji, EmojiMartData } from \"@emoji-mart/data\";\n\nimport { defaultInlineContentSchema } from \"../../blocks/defaultBlocks.js\";\nimport { BlockNoteEditor } from \"../../editor/BlockNoteEditor.js\";\nimport {\n  BlockSchema,\n  InlineContentSchema,\n  StyleSchema,\n} from \"../../schema/index.js\";\nimport { DefaultGridSuggestionItem } from \"./DefaultGridSuggestionItem.js\";\n\n// Temporary fix for https://github.com/missive/emoji-mart/pull/929\nlet emojiLoadingPromise:\n  | Promise<{\n      emojiMart: typeof import(\"emoji-mart\");\n      emojiData: EmojiMartData;\n    }>\n  | undefined;\n\nasync function loadEmojiMart() {\n  if (emojiLoadingPromise) {\n    return emojiLoadingPromise;\n  }\n\n  emojiLoadingPromise = (async () => {\n    // load dynamically because emoji-mart doesn't specify type: module and breaks in nodejs\n    const [emojiMartModule, emojiDataModule] = await Promise.all([\n      import(\"emoji-mart\"),\n      // use a dynamic import to encourage bundle-splitting\n      // and a smaller initial client bundle size\n      import(\"@emoji-mart/data\"),\n    ]);\n\n    const emojiMart =\n      \"default\" in emojiMartModule ? emojiMartModule.default : emojiMartModule;\n    const emojiData =\n      \"default\" in emojiDataModule\n        ? (emojiDataModule.default as EmojiMartData)\n        : (emojiDataModule as EmojiMartData);\n\n    await emojiMart.init({ data: emojiData });\n\n    return { emojiMart, emojiData };\n  })();\n\n  return emojiLoadingPromise;\n}\n\nexport async function getDefaultEmojiPickerItems<\n  BSchema extends BlockSchema,\n  I extends InlineContentSchema,\n  S extends StyleSchema,\n>(\n  editor: BlockNoteEditor<BSchema, I, S>,\n  query: string,\n): Promise<DefaultGridSuggestionItem[]> {\n  if (\n    !(\"text\" in editor.schema.inlineContentSchema) ||\n    editor.schema.inlineContentSchema[\"text\"] !==\n      defaultInlineContentSchema[\"text\"]\n  ) {\n    return [];\n  }\n\n  const { emojiData, emojiMart } = await loadEmojiMart();\n\n  const emojisToShow =\n    query.trim() === \"\"\n      ? Object.values(emojiData.emojis)\n      : ((await emojiMart!.SearchIndex.search(query)) as Emoji[]);\n\n  return emojisToShow.map((emoji) => ({\n    id: emoji.skins[0].native,\n    onItemClick: () => editor.insertInlineContent(emoji.skins[0].native + \" \"),\n  }));\n}\n"],"names":["emojiLoadingPromise","loadEmojiMart","emojiMartModule","emojiDataModule","emojiMart","emojiData","getDefaultEmojiPickerItems","editor","query","defaultInlineContentSchema","emoji"],"mappings":";;;;AAYA,IAAIA;AAOJ,eAAeC,IAAgB;AAC7B,SAAID,MAIJA,KAAuB,YAAY;AAEjC,UAAM,CAACE,GAAiBC,CAAe,IAAI,MAAM,QAAQ,IAAI;AAAA,MAC3D,OAAO,YAAY;AAAA;AAAA;AAAA,MAGnB,OAAO,kBAAkB;AAAA,IAAA,CAC1B,GAEKC,IACJ,aAAaF,IAAkBA,EAAgB,UAAUA,GACrDG,IACJ,aAAaF,IACRA,EAAgB,UAChBA;AAEP,iBAAMC,EAAU,KAAK,EAAE,MAAMC,GAAW,GAEjC,EAAE,WAAAD,GAAW,WAAAC,EAAA;AAAA,EACtB,GAAA,GAEOL;AACT;AAEA,eAAsBM,EAKpBC,GACAC,GACsC;AACtC,MACE,EAAE,UAAUD,EAAO,OAAO,wBAC1BA,EAAO,OAAO,oBAAoB,SAChCE,EAA2B;AAE7B,WAAO,CAAA;AAGT,QAAM,EAAE,WAAAJ,GAAW,WAAAD,EAAA,IAAc,MAAMH,EAAA;AAOvC,UAJEO,EAAM,KAAA,MAAW,KACb,OAAO,OAAOH,EAAU,MAAM,IAC5B,MAAMD,EAAW,YAAY,OAAOI,CAAK,GAE7B,IAAI,CAACE,OAAW;AAAA,IAClC,IAAIA,EAAM,MAAM,CAAC,EAAE;AAAA,IACnB,aAAa,MAAMH,EAAO,oBAAoBG,EAAM,MAAM,CAAC,EAAE,SAAS,GAAG;AAAA,EAAA,EACzE;AACJ;"}